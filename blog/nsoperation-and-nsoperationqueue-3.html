<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="JetjrKc8oFqTtBHbhXoWEt8JqzMxLa7P1eGlKGniGmA" />








  <meta name="baidu-site-verification" content="W2rAP9akzL" />




  <meta name="360-site-verification" content="66512f81ccac9717dbf92c52b925b64d" />







  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.3">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.3" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.3',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="多线程,NSOperation,NSInvocationOperation,NSBlockOperation,NSOperationQueue," />


<meta name="description" content="1 简单使用 NSOperationQueue上一篇文章中看到使用自定义NSOperation来实现多线程，写法有些复杂，但其实，使用NSOperationQueue来实现多线程非常简单 VinnyOperation.m123456789101112131415161718192021- (void)viewDidLoad &amp;#123;    [super viewDidLoad];    //">
<meta name="keywords" content="多线程,NSOperation,NSInvocationOperation,NSBlockOperation,NSOperationQueue">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS多线程(三)：NSOperationQueue 的使用">
<meta property="og:url" content="http://vinnyxiong.cn/blog/nsoperation-and-nsoperationqueue-3.html">
<meta property="og:site_name" content="VinnyXiong&#39;s Notes">
<meta property="og:description" content="1 简单使用 NSOperationQueue上一篇文章中看到使用自定义NSOperation来实现多线程，写法有些复杂，但其实，使用NSOperationQueue来实现多线程非常简单 VinnyOperation.m123456789101112131415161718192021- (void)viewDidLoad &amp;#123;    [super viewDidLoad];    //">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2016-03-01T02:13:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS多线程(三)：NSOperationQueue 的使用">
<meta name="twitter:description" content="1 简单使用 NSOperationQueue上一篇文章中看到使用自定义NSOperation来实现多线程，写法有些复杂，但其实，使用NSOperationQueue来实现多线程非常简单 VinnyOperation.m123456789101112131415161718192021- (void)viewDidLoad &amp;#123;    [super viewDidLoad];    //">



  <link rel="alternate" href="/atom.xml" title="VinnyXiong's Notes" type="application/atom+xml" />




  <link rel="canonical" href="http://vinnyxiong.cn/blog/nsoperation-and-nsoperationqueue-3.html"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>iOS多线程(三)：NSOperationQueue 的使用 | VinnyXiong's Notes</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-74176655-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74176655-3');
</script>



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5d57cf2d1d17a4c46d9fc75184425bf7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">VinnyXiong's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">熊远文的个人博客</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档<span class="badge">16</span>
              </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类<span class="badge">5</span>
              </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签<span class="badge">20</span>
              </a>
        </li>
      
        
        <li class="menu-item menu-item-blogs">
          <a href="/blogs/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-globe"></i> <br />名博</a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'Kh4QjejjfHq9XdTsbHzu','2.0.0');
</script>



    </div>
  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vinnyxiong.cn/blog/nsoperation-and-nsoperationqueue-3.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="熊远文(vinnyxiong)">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VinnyXiong's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">iOS多线程(三)：NSOperationQueue 的使用</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-12-22T20:17:46+08:00">2015-12-22</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS开发/" itemprop="url" rel="index"><span itemprop="name">iOS开发</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/nsoperation-and-nsoperationqueue-3.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/blog/nsoperation-and-nsoperationqueue-3.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/blog/nsoperation-and-nsoperationqueue-3.html" class="leancloud_visitors" data-flag-title="iOS多线程(三)：NSOperationQueue 的使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o">  热度</i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>℃
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="1-简单使用-NSOperationQueue"><a href="#1-简单使用-NSOperationQueue" class="headerlink" title="1 简单使用 NSOperationQueue"></a>1 简单使用 NSOperationQueue</h2><p>上一篇文章中看到使用自定义<code>NSOperation</code>来实现多线程，写法有些复杂，但其实，使用<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/NSOperationQueue_class/" target="_blank" rel="noopener"><code>NSOperationQueue</code></a>来实现多线程非常简单</p>
<figure class="highlight objc"><figcaption><span>VinnyOperation.m</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 创建3个 NSInvocationOperation 操作</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *opQueue = [<span class="built_in">NSOperationQueue</span> new];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 可以传递一个 NSObject 给operation的操作方法</span></span><br><span class="line">        <span class="built_in">NSDictionary</span> *dict = [<span class="built_in">NSDictionary</span> dictionaryWithObject:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Operation_%lu"</span>, i] forKey:<span class="string">@"key"</span>];</span><br><span class="line">        <span class="built_in">NSInvocationOperation</span> *op = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(operationSelector:) object:dict];</span><br><span class="line">        [opQueue addOperation:op];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// NSInvocationOperation 操作执行的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)operationSelector:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 接收传进来的dict</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"dictValue = %@"</span>, [dict valueForKey:<span class="string">@"key"</span>]);</span><br><span class="line">    sleep(<span class="number">10</span>);  <span class="comment">// 加个睡眠模仿耗时操作</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"currentThread = %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"mainThread    = %@"</span>, [<span class="built_in">NSThread</span> mainThread]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>控制台输出结果为：<a id="more"></a></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">18.282</span> test[<span class="number">57194</span>:<span class="number">18487531</span>] dictValue = Operation_0</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">18.282</span> test[<span class="number">57194</span>:<span class="number">18487530</span>] dictValue = Operation_1</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">18.282</span> test[<span class="number">57194</span>:<span class="number">18487533</span>] dictValue = Operation_2</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">28.283</span> test[<span class="number">57194</span>:<span class="number">18487530</span>] currentThread = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7fbf40435bb0</span>&gt;&#123;number = <span class="number">2</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">28.284</span> test[<span class="number">57194</span>:<span class="number">18487531</span>] currentThread = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7fbf4050f2a0</span>&gt;&#123;number = <span class="number">3</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">28.284</span> test[<span class="number">57194</span>:<span class="number">18487533</span>] currentThread = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7fbf4290f560</span>&gt;&#123;number = <span class="number">4</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">28.284</span> test[<span class="number">57194</span>:<span class="number">18487530</span>] mainThread    = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7fbf405058c0</span>&gt;&#123;number = <span class="number">1</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">28.284</span> test[<span class="number">57194</span>:<span class="number">18487531</span>] mainThread    = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7fbf405058c0</span>&gt;&#123;number = <span class="number">1</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">28.284</span> test[<span class="number">57194</span>:<span class="number">18487533</span>] mainThread    = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7fbf405058c0</span>&gt;&#123;number = <span class="number">1</span>, name = (null)&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出来这三个操作是并发执行的，而且都不在主线程中执行。</p>
<h2 id="2-NSOperationQueue-的其他属性"><a href="#2-NSOperationQueue-的其他属性" class="headerlink" title="2 NSOperationQueue 的其他属性"></a>2 NSOperationQueue 的其他属性</h2><p>添加操作有3个方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接添加一个 NSOperation 操作，并且加入并发队列，只要当前队列允许，就会立刻执行。</span></span><br><span class="line">- (<span class="keyword">void</span>)addOperation:(<span class="built_in">NSOperation</span> *)op;</span><br><span class="line"><span class="comment">// 添加一组操作，如果 waitUntilFinished 为 NO，则必须在当前队列中的所有操作都执行完了，才会执行这组操作，否则立刻执行。</span></span><br><span class="line">- (<span class="keyword">void</span>)addOperations:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSOperation</span> *&gt; *)ops waitUntilFinished:(<span class="built_in">BOOL</span>)wait <span class="built_in">NS_AVAILABLE</span>(<span class="number">10</span>_6, <span class="number">4</span>_0);</span><br><span class="line"><span class="comment">// 直接在这里写一个block，block中的操作加入并发队列，并且只要当前队列允许执行，就会立刻执行。</span></span><br><span class="line">- (<span class="keyword">void</span>)addOperationWithBlock:(<span class="keyword">void</span> (^)(<span class="keyword">void</span>))block <span class="built_in">NS_AVAILABLE</span>(<span class="number">10</span>_6, <span class="number">4</span>_0);</span><br></pre></td></tr></table></figure>
<p>接下来看其他的属性</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回当前队列中的所有操作NSOperation</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span>&lt;__kindof <span class="built_in">NSOperation</span> *&gt; *operations;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回当前队列中的操作数量，对应 operations.count</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">NSUInteger</span> operationCount <span class="built_in">NS_AVAILABLE</span>(<span class="number">10</span>_6, <span class="number">4</span>_0);</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可读写的属性，当设备性能不足或根据需求要限制并行的操作数量时，可以设置这个值。</span></span><br><span class="line"><span class="comment">// 设置了这个值之后，队列中并发执行的操作数量不会大于这个值。超出这个值在排队中的操作会处于休眠状态。</span></span><br><span class="line"><span class="comment">// 默认值为 NSOperationQueueDefaultMaxConcurrentOperationCount = -1</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">NSInteger</span> maxConcurrentOperationCount;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以给队列指定一个名字用来做标识</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name <span class="built_in">NS_AVAILABLE</span>(<span class="number">10</span>_6, <span class="number">4</span>_0);</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给队列指定一个优先级，默认为 NSQualityOfServiceDefault = -1</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">NSQualityOfService</span> qualityOfService <span class="built_in">NS_AVAILABLE</span>(<span class="number">10</span>_10, <span class="number">8</span>_0);</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ??? 这个不是太理解</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">assign</span> <span class="comment">/* actually retain */</span>) <span class="built_in">dispatch_queue_t</span> underlyingQueue <span class="built_in">NS_AVAILABLE</span>(<span class="number">10</span>_10, <span class="number">8</span>_0);</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取消队列中的所有操作。其实就是调用 operations 中每个操作的`cancel`方法才取消操作。</span></span><br><span class="line"><span class="comment">// 但是，在前面的文章中说过，调用`cancel`方法并不会终止操作，而是设置`cancelled`属性为 YES，</span></span><br><span class="line"><span class="comment">// 这就需要自己在操作中分节点去判断`cancelled`属性了，在适当的时机结束操作。</span></span><br><span class="line">- (<span class="keyword">void</span>)cancelAllOperations;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用这个方法时，会判断 NSOperationQueue 中的操作是否全部执行完，如果没有，则调用者所在的线程会在调用处等待。</span></span><br><span class="line"><span class="comment">// 直到 NSOperationQueue 中的所有操作执行完成，当前线程才继续执行。如果 NSOperationQueue 为空，则该方法立刻返回。</span></span><br><span class="line">- (<span class="keyword">void</span>)waitUntilAllOperationsAreFinished;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取得调用者的当前线程中的 NSOperationQueue 操作队列</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">NSOperationQueue</span> *)currentQueue <span class="built_in">NS_AVAILABLE</span>(<span class="number">10</span>_6, <span class="number">4</span>_0);</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取得主线程中的 </span></span><br><span class="line">+ (<span class="built_in">NSOperationQueue</span> *)mainQueue <span class="built_in">NS_AVAILABLE</span>(<span class="number">10</span>_6, <span class="number">4</span>_0);</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">getter</span>=isSuspended) <span class="built_in">BOOL</span> suspended;</span><br></pre></td></tr></table></figure>
<p>这个值很有意思，从字面意思理解是暂停队列，但是怎么个暂停呢？从官方文档上看</p>
<blockquote><p><strong>Discussion</strong><br>When the value of this property is NO, the queue actively starts operations that are in the queue and ready to execute. Setting this property to YES prevents the queue from starting any queued operations, but already executing operations continue to execute. You may continue to add operations to a queue that is suspended but those operations are not scheduled for execution until you change this property to NO.</p>
<p>Operations are removed from the queue only when they finish executing. However, in order to finish executing, an operation must first be started. Because a suspended queue does not start any new operations, it does not remove any operations (including cancelled operations) that are currently queued and not executing.</p>
<p>You may monitor changes to the value of this property using key-value observing. Configure an observer to monitor the suspended key path of the operation queue.</p>
<p>The default value of this property is NO.</p>
</blockquote>
<p>大概翻译一下，如果这个值设置为 NO，那说明这个队列已经准备好了可以执行了。如果这个值设置为 YES，那么已经添加到队列中的操作还是可以执行了，而后面继续添加进队列中的操作才处于<code>暂停</code>状态，直到你再次将这个值设置为 NO 时，后面加入的操作才会继续执行。这个属性的默认值是 NO。</p>
<p>来看一下使用的方法例子：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 创建3个 NSInvocationOperation 操作</span></span><br><span class="line">    _opQueue = [<span class="built_in">NSOperationQueue</span> new];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 可以传递一个 NSObject 给operation的操作方法</span></span><br><span class="line">        <span class="built_in">NSDictionary</span> *dict = [<span class="built_in">NSDictionary</span> dictionaryWithObject:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Operation_%lu"</span>, i] forKey:<span class="string">@"key"</span>];</span><br><span class="line">        <span class="built_in">NSInvocationOperation</span> *op = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(operationSelector:) object:dict];</span><br><span class="line">        [_opQueue addOperation:op];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这里设置为 YES</span></span><br><span class="line">    _opQueue.suspended = <span class="literal">YES</span>;</span><br><span class="line">    <span class="comment">// 然后再添加一个操作，序号为 9</span></span><br><span class="line">    <span class="built_in">NSDictionary</span> *dict = [<span class="built_in">NSDictionary</span> dictionaryWithObject:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Operation_%d"</span>, <span class="number">9</span>] forKey:<span class="string">@"key"</span>];</span><br><span class="line">    <span class="built_in">NSInvocationOperation</span> *op = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(operationSelector:) object:dict];</span><br><span class="line">    [_opQueue addOperation:op];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// NSInvocationOperation 操作执行的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)operationSelector:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 接收传进来的dict</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"dictValue = %@"</span>, [dict valueForKey:<span class="string">@"key"</span>]);</span><br><span class="line">    sleep(<span class="number">10</span>);  <span class="comment">// 加个睡眠模仿耗时操作</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"currentThread = %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"mainThread    = %@"</span>, [<span class="built_in">NSThread</span> mainThread]);</span><br><span class="line">    <span class="comment">// 执行完其中一个操作之后把 suspended 改为 NO。</span></span><br><span class="line">    _opQueue.suspended = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">07.546</span> test[<span class="number">57547</span>:<span class="number">18605364</span>] dictValue = Operation_2</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">07.546</span> test[<span class="number">57547</span>:<span class="number">18605360</span>] dictValue = Operation_0</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">07.546</span> test[<span class="number">57547</span>:<span class="number">18605361</span>] dictValue = Operation_1</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">10.547</span> test[<span class="number">57547</span>:<span class="number">18605361</span>] currentThread = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7ff598d07b00</span>&gt;&#123;number = <span class="number">3</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">10.547</span> test[<span class="number">57547</span>:<span class="number">18605364</span>] currentThread = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7ff59a9784f0</span>&gt;&#123;number = <span class="number">2</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">10.547</span> test[<span class="number">57547</span>:<span class="number">18605360</span>] currentThread = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7ff59aa05100</span>&gt;&#123;number = <span class="number">4</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">10.547</span> test[<span class="number">57547</span>:<span class="number">18605364</span>] mainThread    = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7ff598c08770</span>&gt;&#123;number = <span class="number">1</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">10.547</span> test[<span class="number">57547</span>:<span class="number">18605360</span>] mainThread    = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7ff598c08770</span>&gt;&#123;number = <span class="number">1</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">10.547</span> test[<span class="number">57547</span>:<span class="number">18605361</span>] mainThread    = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7ff598c08770</span>&gt;&#123;number = <span class="number">1</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">10.547</span> test[<span class="number">57547</span>:<span class="number">18605513</span>] dictValue = Operation_9</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">13.620</span> test[<span class="number">57547</span>:<span class="number">18605513</span>] currentThread = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7ff598c08ce0</span>&gt;&#123;number = <span class="number">5</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">13.620</span> test[<span class="number">57547</span>:<span class="number">18605513</span>] mainThread    = &lt;<span class="built_in">NSThread</span>: <span class="number">0x7ff598c08770</span>&gt;&#123;number = <span class="number">1</span>, name = (null)&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出来，操作9是在<code>suspended</code>改为 NO 之后才开始执行的。</p>
<p><strong>最后：</strong>以上很多属性都支持 KVO ，可以通过监听某个值的变化来做不同的操作，这里就不赘述了。</p>
<h2 id="3-总结"><a href="#3-总结" class="headerlink" title="3 总结"></a>3 总结</h2><p><strong>NSOperationQueue</strong>为我们提供了非常简便的使用多线程的方法，如果需要使用<code>NSOperation</code>，则更多建议使用<code>NSOperationQueue</code>而不是自定义<code>NSOperation</code>。</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="熊远文(vinnyxiong) 微信支付"/>
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>熊远文(vinnyxiong)</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://vinnyxiong.cn/blog/nsoperation-and-nsoperationqueue-3.html" title="iOS多线程(三)：NSOperationQueue 的使用">http://vinnyxiong.cn/blog/nsoperation-and-nsoperationqueue-3.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/多线程/" rel="tag"># 多线程</a>
          
            <a href="/tags/NSOperation/" rel="tag"># NSOperation</a>
          
            <a href="/tags/NSInvocationOperation/" rel="tag"># NSInvocationOperation</a>
          
            <a href="/tags/NSBlockOperation/" rel="tag"># NSBlockOperation</a>
          
            <a href="/tags/NSOperationQueue/" rel="tag"># NSOperationQueue</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/nsoperation-and-nsoperationqueue-2.html" rel="next" title="iOS多线程(二)：NSOperation 自定义子类实现非并发和并发操作">
                <i class="fa fa-chevron-left"></i> iOS多线程(二)：NSOperation 自定义子类实现非并发和并发操作
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/hello-world.html" rel="prev" title="Hello World">
                Hello World <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="熊远文(vinnyxiong)" />
            
              <p class="site-author-name" itemprop="name">熊远文(vinnyxiong)</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/vinnyxiong" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://coding.net/vinnyxiong" target="_blank" title="Coding" rel="external nofollow"><i class="fa fa-fw fa-github"></i>Coding</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://www.jianshu.com/users/5eef341da562/latest_articles" target="_blank" title="简书" rel="external nofollow"><i class="fa fa-fw fa-pencil-square"></i>简书</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:xiongyuanwen@gmail.com" target="_blank" title="E-Mail" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://notes.iissnan.com/" title="IIssNan's Notes" target="_blank">IIssNan's Notes</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://theme-next.iissnan.com/" title="NexT官网" target="_blank">NexT官网</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://mindhacks.cn/" title="刘未鹏|Mind Hacks" target="_blank">刘未鹏|Mind Hacks</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://macshuo.com/" title="MacTalk" target="_blank">MacTalk</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.devtang.com/" title="唐巧的博客" target="_blank">唐巧的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://onevcat.com/" title="OneV's Den" target="_blank">OneV's Den</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://wereadteam.github.io/" title="WeRead团队博客" target="_blank">WeRead团队博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.ibireme.com/author/ibireme/" title="ibireme YYKit 组件作者" target="_blank">ibireme YYKit 组件作者</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://draveness.me/" title="draveness" target="_blank">draveness</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.cnbang.net/" title="bang JSPatch 作者" target="_blank">bang JSPatch 作者</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://lwbaptx.cn/" title="lwbaptx" target="_blank">lwbaptx</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-简单使用-NSOperationQueue"><span class="nav-text">1 简单使用 NSOperationQueue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-NSOperationQueue-的其他属性"><span class="nav-text">2 NSOperationQueue 的其他属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-总结"><span class="nav-text">3 总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heartbeat"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">熊远文(vinnyxiong)</span>

  

  
</div>


  



  <div class="powered-by">由 <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.3</div>


<div class="hosted-by">
  Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>
</div>



        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user">  您是第</i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      个来访者
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye">  本站总浏览</i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.3"></script>



  

  
    <script id="dsq-count-scr" src="https://vinnyxiong.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://vinnyxiong.cn/blog/nsoperation-and-nsoperationqueue-3.html';
        this.page.identifier = '/blog/nsoperation-and-nsoperationqueue-3.html';
        this.page.title = 'iOS多线程(三)：NSOperationQueue 的使用';
      };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://vinnyxiong.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        $(function () {
          var offsetTop = $('#comments').offset().top - $(window).height();
          if (offsetTop <= 0) {
            // load directly when there's no a scrollbar
            loadComments();
          } else {
            $(window).on('scroll.disqus_scroll', function () {
              var scrollTop = document.documentElement.scrollTop;
              if (scrollTop >= offsetTop) {
                $(window).off('.disqus_scroll');
                loadComments();
              }
            });
          }
        });
      
    </script>
  





	





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("BgqAOo4j55sFAxQnRXUpvt7f-gzGzoHsz", "05X66f6dxUedaS2jasipMPen");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  

  


  
  

  

  

  

  

</body>
</html>
